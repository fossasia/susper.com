sudo: required
dist: trusty
language: node_js
node_js: 6

cache:
    bundler: true
    directories:
    - node_modules

matrix:
  include:
  # Build and deploy
  - script: ng build --prod
    after_success:
      - bash ./pr_deploy.sh
      - bash ./deploy.sh

  # Run unit tests and coverage
  - before_script:
      - export CHROME_BIN=chromium-browser
      - export DISPLAY=:99.0
      - sh -e /etc/init.d/xvfb start
    script:
      - ng test --single-run --code-coverage --reporters=coverage-istanbul
      - bash <(curl -s https://codecov.io/bash)

  # Run code lint tests
  - script: ng lint

branches:
   only: master
